clear;
clc;

filePath='/Users/dinhgiabao/Desktop/HK1-nam3/XLTinHieu/endcourse/TinHieuHuanLuyen/';
files = { '02FVA', '03MAB', '06FTB','01MDA'};
name = char(strcat(filePath, files(4), '.wav'));
%[data, fs] = audioread('/Users/dinhgiabao/Desktop/HK1-nam3/XLTinHieu/endcourse/TinHieuHuanLuyen/06FTB');
FTB = [0,1.52,1.92,3.91,4.35,6.18,6.6,8.67,9.14,10.94,11.33,12.75];
%FVA=[0.00,0.83,1.37,2.09,2.60,3.57,4.00,4.76,5.33,6.18,6.68,7.18];
MDA = [0,0.45,0.81,1.53,1.85,2.69,2.86,3.78,4.15,4.84,5.14,5.58];
MAB =[0,1.03,1.42,2.46,2.80,4.21,4.52,6.81,7.14,8.22,8.50,9.37];

[data,t1,fs]=normalizedAmplitude(name);


STEtk=[];
MAtk=[];
tmp=2;
 for i = 1 : floor(length(MDA)/2)  
     if(tmp>=(length(MDA)-1))
        break;
     end
    
     t1 = floor(MDA(tmp)*fs); 
     t2 = floor(MDA(tmp+1)*fs);
     
     x=data(t1:t2);
     
     time_duration=0.03; %do dai moi khung 
    lag = 0.01; %do tre moi khung
    pdlow=1/450; pdhigh=1/70; 
    %gioi han tan so F0 trong khoang 70hz->450hz->giam do phuc tap

    n_min = floor(pdlow*fs);
    n_max = floor(pdhigh*fs);

    lenX = length(x) ;%do dai tin hieu vao theo mau
    nSampleFrame = time_duration*fs; %do dai 1 frame tinh theo mau
    nSampleLag = lag*fs; %do dai do dich cua frame theo mau
    nFrame= int32(lenX-nSampleFrame)/nSampleLag+1;
     
    %ZCRarr=zeros(1,nFrame);
    STEarr=zeros(1,nFrame);
    MAarr= zeros(1,nFrame);
    
    %chia frame
    for frame_index=1:nFrame
        a=(frame_index-1)*nSampleLag+1;
        b=(frame_index-1)*nSampleLag+nSampleFrame+1;
        if b <= lenX
            frame= x(a:b); %xac dinh 1 frame
        else 
            frame= x(a:lenX);
            frame(lenX:b)=0;
        end
        
%         %ZCR computing
%         zcr=0;
%         for  i = 2:nSampleFrame
%             if frame(i)*frame(i-1) <0
%                 zcr=zcr+1;
%             end
%         end
%         ZCRarr(frame_index)=zcr;


         %MA computing
        MAarr(frame_index)= sum(abs(frame));
        
        %STE computing
        STEarr(frame_index)=sum(frame.^2);   
    end
    
         
    MAarr= MAarr./max(MAarr);
    STEarr=STEarr./max(STEarr);
    
    STEtk = [STEtk STEarr];
    MAtk = [MAtk MAarr];
    tmp=tmp+2;
 end

meanSTE = mean(STEtk)
stdSTE = std(STEtk)
meanMA= mean(MAtk)
stdMA= std(MAtk)

%MDA 
%v       ste                                     zcr
%        mean:0.3720                    mean:0.1471
%        std:0.3699                       std:0.1899

%uv    mean:0.3982                      mean:0.2192
%       std:0.3753                          std:0.2538       
%=>  ste ~=0.1958           zcr= 0.1858     
  

%MBA 
%uv       ste                                     zcr
%        mean:0.2542                     mean:0.2014
%        std:0.2034                          std:0.1654

%v    mean:0.3247                   mean:0.2705
%       std:0.2889                          std:0.2659 
%=> ste~=0.2467                     zcr=0.1858


%FTB
%v       ste                                     zcr
%        mean:0.4498                    mean:0.1795
%        std:0.3426                         std:0.2264

%uv    mean:0.2406                     mean:0.2132
%       std:0.1661                         std:0.1776       
%=>  ste ~=0.25695           zcr= 0.22075


%FVA
%v       ste                                     zcr
%        mean:0.4349                 mean:0.7205
%        std:0.3625                         std:0.1919

%uv    mean:0.3590                     mean:0.6180
%       std:0.1967                        std:0.1549    
%=>  ste ~=0.25           zcr= 0.19

%====>ste=0.3           zcr=


